<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MergeSort Absteigend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:disabled {
            background-color: #cccccc;
        }
        
        .visualization {
            display: flex;
            height: 300px;
            align-items: flex-end;
            gap: 2px;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
        }
        
        .bar {
            background-color: #3498db;
            width: 30px;
            transition: height 0.3s, background-color 0.3s;
            position: relative;
        }
        
        .bar.highlight {
            background-color: #e74c3c;
        }
        
        .bar.sorted {
            background-color: #2ecc71;
        }
        
        .bar-label {
            position: absolute;
            bottom: -25px;
            width: 100%;
            text-align: center;
            font-size: 12px;
        }
        
        .explanation {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MergeSort Absteigend (Größte zu Kleinste)</h1>
        
        <div class="controls">
            <button id="generate-btn">Neues Array</button>
            <button id="sort-btn">Sortieren starten</button>
            <div>
                <label for="speed">Geschwindigkeit:</label>
                <input type="range" id="speed" min="1" max="20" value="10">
            </div>
            <div>
                <label for="direction">Sortierrichtung:</label>
                <select id="direction">
                    <option value="desc">Absteigend (Größte zuerst)</option>
                    <option value="asc">Aufsteigend (Kleinste zuerst)</option>
                </select>
            </div>
        </div>
        
        <div class="visualization" id="visualization"></div>
        
        <div class="explanation" id="explanation">
            Klicken Sie auf "Sortieren starten", um den MergeSort-Algorithmus zu visualisieren.
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const visualization = document.getElementById('visualization');
            const generateBtn = document.getElementById('generate-btn');
            const sortBtn = document.getElementById('sort-btn');
            const speedControl = document.getElementById('speed');
            const explanation = document.getElementById('explanation');
            const directionSelect = document.getElementById('direction');
            
            let array = [];
            let delay = 500;
            const maxValue = 100;
            
            // Initial array generation
            generateArray();
            
            // Event listeners
            generateBtn.addEventListener('click', generateArray);
            sortBtn.addEventListener('click', startMergeSort);
            speedControl.addEventListener('input', updateSpeed);
            
            function updateSpeed() {
                delay = 1050 - (speedControl.value * 50);
            }
            
            function generateArray() {
                array = [];
                visualization.innerHTML = '';
                explanation.innerHTML = 'Klicken Sie auf "Sortieren starten", um den MergeSort-Algorithmus zu visualisieren.';
                
                // Generate 15 random numbers between 5 and maxValue
                for (let i = 0; i < 15; i++) {
                    array.push(Math.floor(Math.random() * (maxValue - 5 + 1)) + 5);
                }
                
                renderBars(array);
            }
            
            function renderBars(arr, left = null, right = null, merged = false) {
                visualization.innerHTML = '';
                
                arr.forEach((value, index) => {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.height = `${(value / maxValue) * 100}%`;
                    
                    const label = document.createElement('div');
                    label.className = 'bar-label';
                    label.textContent = value;
                    bar.appendChild(label);
                    
                    if (left !== null && index >= left && index <= right) {
                        bar.classList.add(merged ? 'sorted' : 'highlight');
                    }
                    
                    visualization.appendChild(bar);
                });
            }
            
            async function startMergeSort() {
                sortBtn.disabled = true;
                generateBtn.disabled = true;
                
                const direction = directionSelect.value;
                
                if (direction === 'desc') {
                    await mergeSortDescendingVisual(array, 0, array.length - 1);
                    explanation.innerHTML = 'Absteigende Sortierung abgeschlossen! (Größte zu Kleinste)';
                } else {
                    await mergeSortAscendingVisual(array, 0, array.length - 1);
                    explanation.innerHTML = 'Aufsteigende Sortierung abgeschlossen! (Kleinste zu Größte)';
                }
                
                sortBtn.disabled = false;
                generateBtn.disabled = false;
            }
            
            // Absteigender MergeSort (Größte zu Kleinste)
            async function mergeSortDescendingVisual(arr, left, right) {
                if (left >= right) return;
                
                const mid = Math.floor((left + right) / 2);
                
                explanation.innerHTML = `Teile Array von Index ${left} bis ${right} in zwei Hälften (Mitte bei ${mid})`;
                renderBars(arr, left, right);
                await sleep(delay);
                
                await mergeSortDescendingVisual(arr, left, mid);
                await mergeSortDescendingVisual(arr, mid + 1, right);
                
                explanation.innerHTML = `Füge sortierte Hälften von Index ${left} bis ${right} zusammen (absteigend)`;
                await mergeDescendingVisual(arr, left, mid, right);
                
                renderBars(arr, left, right, true);
                await sleep(delay);
            }
            
            async function mergeDescendingVisual(arr, left, mid, right) {
                let i = left;
                let j = mid + 1;
                let temp = [];
                
                while (i <= mid && j <= right) {
                    // Wichtig: Vergleich ">" statt "<" für absteigende Sortierung
                    if (arr[i] > arr[j]) {
                        temp.push(arr[i++]);
                    } else {
                        temp.push(arr[j++]);
                    }
                }
                
                while (i <= mid) temp.push(arr[i++]);
                while (j <= right) temp.push(arr[j++]);
                
                for (let k = 0; k < temp.length; k++) {
                    arr[left + k] = temp[k];
                    renderBars(arr, left, left + k);
                    await sleep(delay/2);
                }
            }
            
            // Aufsteigender MergeSort (Kleinste zu Größte) - zum Vergleich
            async function mergeSortAscendingVisual(arr, left, right) {
                if (left >= right) return;
                
                const mid = Math.floor((left + right) / 2);
                
                explanation.innerHTML = `Teile Array von Index ${left} bis ${right} in zwei Hälften (Mitte bei ${mid})`;
                renderBars(arr, left, right);
                await sleep(delay);
                
                await mergeSortAscendingVisual(arr, left, mid);
                await mergeSortAscendingVisual(arr, mid + 1, right);
                
                explanation.innerHTML = `Füge sortierte Hälften von Index ${left} bis ${right} zusammen (aufsteigend)`;
                await mergeAscendingVisual(arr, left, mid, right);
                
                renderBars(arr, left, right, true);
                await sleep(delay);
            }
            
            async function mergeAscendingVisual(arr, left, mid, right) {
                let i = left;
                let j = mid + 1;
                let temp = [];
                
                while (i <= mid && j <= right) {
                    if (arr[i] < arr[j]) {
                        temp.push(arr[i++]);
                    } else {
                        temp.push(arr[j++]);
                    }
                }
                
                while (i <= mid) temp.push(arr[i++]);
                while (j <= right) temp.push(arr[j++]);
                
                for (let k = 0; k < temp.length; k++) {
                    arr[left + k] = temp[k];
                    renderBars(arr, left, left + k);
                    await sleep(delay/2);
                }
            }
            
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        });
    </script>
</body>
</html>